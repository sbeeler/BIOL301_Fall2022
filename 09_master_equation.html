
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Week 9: Numerically integrating a probability distribution – Master equations &#8212; BIOL301 Fall 2022 materials</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Week 8: Stochastic simulations – Gillespie Algorithm" href="08_stochastic_simulation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/download.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">BIOL301 Fall 2022 materials</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to the BIOL301 Webpage
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_configuring_computer.html">
   Week 1: Configuring your computer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_intro_to_jupyter.html">
   Week 1: Introduction to JupyterLab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_terminal_commands.html">
   Week 1: Terminal Commands
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_intro_to_latex.html">
   Week 1: Introduction to LaTeX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_numerical_integration.html">
   Week 3: Numerical Integration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_slope_fields.html">
   Week 3: Slope fields and other graphical analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_lotka_volterra.html">
   Week 4: Lotka-Volterra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_scipy_integration.html">
   Week 4: Numerical integration with scipy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_bifurcations.html">
   Week 5: Bifurcations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_midterm1_review.html">
   Midterm 1 Review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_insect.html">
   Week 6: Insect outbreak with interactive plots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_gene_expression.html">
   Week 7: Modeling mRNA and protein production
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_stochastic_simulation.html">
   Week 8: Stochastic simulations – Gillespie Algorithm
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Week 9: Numerically integrating a probability distribution – Master equations
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/sbeeler/BIOL301_Fall2022/master?urlpath=tree/docs/09_master_equation.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/sbeeler/BIOL301_Fall2022/tree/gh-pages"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/sbeeler/BIOL301_Fall2022/tree/gh-pages/issues/new?title=Issue%20on%20page%20%2F09_master_equation.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/09_master_equation.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-objectives">
   Learning Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#diffusion-via-coin-flips">
   Diffusion via coin flips
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-1">
     Activity 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-2">
     Activity 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#master-equation">
   Master equation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-3">
     Activity 3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-4-start-of-the-homework">
     Activity 4 / Start of the homework
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-1-diffusion-in-a-box">
   Problem 1 - Diffusion in a box
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-2-diffusion-in-a-smaller-box">
   Problem 2 - Diffusion in a smaller box
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-3-setting-up-a-gradient">
   Problem 3 - Setting up a gradient
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-4-fluorescence-recovery-after-photobleaching-frap">
   Problem 4 - Fluorescence recovery after photobleaching (FRAP)
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Week 9: Numerically integrating a probability distribution – Master equations</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-objectives">
   Learning Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#diffusion-via-coin-flips">
   Diffusion via coin flips
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-1">
     Activity 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-2">
     Activity 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#master-equation">
   Master equation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-3">
     Activity 3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-4-start-of-the-homework">
     Activity 4 / Start of the homework
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-1-diffusion-in-a-box">
   Problem 1 - Diffusion in a box
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-2-diffusion-in-a-smaller-box">
   Problem 2 - Diffusion in a smaller box
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-3-setting-up-a-gradient">
   Problem 3 - Setting up a gradient
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-4-fluorescence-recovery-after-photobleaching-frap">
   Problem 4 - Fluorescence recovery after photobleaching (FRAP)
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="week-9-numerically-integrating-a-probability-distribution-master-equations">
<h1>Week 9: Numerically integrating a probability distribution – Master equations<a class="headerlink" href="#week-9-numerically-integrating-a-probability-distribution-master-equations" title="Permalink to this headline">#</a></h1>
<hr><section id="learning-objectives">
<h2>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Revisiting from last semester: simulate diffusion via “coin flips”</p></li>
<li><p>Approach diffusion using a “Master Equation” approach to numerically integrate the distribution of diffusion particles over time</p></li>
<li><p>Alter the initial conditions and parameters of the integration to simulate different biological processes</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numba</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="diffusion-via-coin-flips">
<h2>Diffusion via coin flips<a class="headerlink" href="#diffusion-via-coin-flips" title="Permalink to this headline">#</a></h2>
<p>As a throwback to last semester, let’s simulate a particle diffusing over time. We can consider the particle of interest as starting at position 0. At each time point, it will move +1 if we “flip a coin” and get heads, and will move -1 if get tails.</p>
<p>As a reminder, we can simulate flipping a coin by using the <code class="docutils literal notranslate"><span class="pre">random</span></code> module:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="n">rand</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5319746989262999
</pre></div>
</div>
</div>
</div>
<p>Once we have a randomly generated number, we can assign what we want to do next based on the value. As an example, I print <code class="docutils literal notranslate"><span class="pre">heads</span></code> or <code class="docutils literal notranslate"><span class="pre">tails</span></code> below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">rand</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;heads&quot;</span><span class="p">)</span>
          
<span class="k">if</span> <span class="n">rand</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tails&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>heads
</pre></div>
</div>
</div>
</div>
<section id="activity-1">
<h3>Activity 1<a class="headerlink" href="#activity-1" title="Permalink to this headline">#</a></h3>
<p>Below, use this concept of “coin flips” to simulate a particle’s position over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># number of steps</span>
<span class="n">n_steps</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># array to store particle position</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>

<span class="c1"># simulate the particle moving moving over time</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="c1"># Show the trajectory</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;steps taken&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09_master_equation_8_0.png" src="_images/09_master_equation_8_0.png" />
</div>
</div>
<p>As we can see, the position of the particle moves about the origin in an un-directed fashion as a result of the randomness of the steps taken. However, it’s hard to conclude anything from this single trace. Only by simulating many of these trajectories can we begin to conclude some of the scaling properties of diffusing particles.</p>
</section>
<section id="activity-2">
<h3>Activity 2<a class="headerlink" href="#activity-2" title="Permalink to this headline">#</a></h3>
<p>Repeat the simulation above for 100 particles and plot the trajectories on the same plot. We can use this to get a sense of the typical behavior since a single trajectory might not be representative.</p>
</section>
</section>
<section id="master-equation">
<h2>Master equation<a class="headerlink" href="#master-equation" title="Permalink to this headline">#</a></h2>
<p>While it is useful to demonstrate this behavior stochastically as we’ve done above, we may also wish to know the deterministic behavior, akin to when we’ve done numerical integration in for differential equations. For this, we will introduce something known as the “Master Equation” as a way to track not individual particles, but instead the <em>probability</em> that particles will be found at various positions.</p>
<p>This involves keeping track of the probability <span class="math notranslate nohighlight">\(p(n,t)\)</span> of particles being at location <span class="math notranslate nohighlight">\(n\)</span> at time <span class="math notranslate nohighlight">\(t\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\overbrace{p(n, t+\Delta t)}^{\text {new probability }}=\underbrace{p(n, t)}_{\text {old probability }}+\overbrace{k \Delta t p(n-1, t)}^{\text {particles moving in from left }}+\underbrace{k \Delta t p(n+1, t)}_{\text {particles moving in from right }}-\overbrace{2 k \Delta t p(n, t)}^{\text {particles leaving to left or right }} .
\]</div>
<p>This master equation allows us to calculate the probability of the walker being at position  n  at the next time step  <span class="math notranslate nohighlight">\(t+ \Delta t\)</span> , given the probabilities at the current time step  <span class="math notranslate nohighlight">\(t\)</span> . <span class="math notranslate nohighlight">\(k\)</span>  is the “hopping rate” between neighboring positions, and  <span class="math notranslate nohighlight">\(\Delta t\)</span>  is the time step used in the numerical calculation. For this simulation, we will use a 2D-array where we are keeping track of <span class="math notranslate nohighlight">\(N\)</span> “boxes” that the particles can be in over time.</p>
<p>Due computational limits, there are only so many “boxes” we can keep track of. This means we will have to specify what are known as “boundary conditions” at our left-most and right-most boxes.</p>
<section id="activity-3">
<h3>Activity 3<a class="headerlink" href="#activity-3" title="Permalink to this headline">#</a></h3>
<p>Below specify what the Master Equation would be for the 0th and Nth boxes, keeping in mind that particles :</p>
<div class="math notranslate nohighlight">
\[
\overbrace{p(0, t+\Delta t)}^{\text {new probability }}=\underbrace{p(0, t)}_{\text {old probability }} + \ ???
\]</div>
<div class="math notranslate nohighlight">
\[
\overbrace{p(N, t+\Delta t)}^{\text {new probability }}=\underbrace{p(N, t)}_{\text {old probability }} + \ ???
\]</div>
<p>Below I set up the parameters and arrays we will need for the Master Equation integration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># number of boxes</span>
<span class="n">n_boxes</span> <span class="o">=</span> <span class="mi">41</span>

<span class="c1"># time increment (Delta t) in seconds</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># number of steps</span>
<span class="n">n_steps</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># hopping rate constant (k) in sec^-1</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># initialize the probability distribution</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_boxes</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">])</span>

<span class="c1"># find the middle box</span>
<span class="n">n_center</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_boxes</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># set the middle box to have probability 1 at the initial time step </span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_boxes</span><span class="p">),</span> <span class="n">p</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;box position&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;proability&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09_master_equation_13_0.png" src="_images/09_master_equation_13_0.png" />
</div>
</div>
</section>
<section id="activity-4-start-of-the-homework">
<h3>Activity 4 / Start of the homework<a class="headerlink" href="#activity-4-start-of-the-homework" title="Permalink to this headline">#</a></h3>
<p>Using the Master Equations we specified above, integrate the <span class="math notranslate nohighlight">\(p(n,t)\)</span> probability array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># loop through the number of steps
for t in range(1, n_steps):
    
    # update probability array in the interior region
    for b in range(1,n_boxes-1):
        p[b,t] = p[b,t-1] + ???

    # update probability array for the left-most box
    p[0,t] = p[0, t-1] + ???
    
    # update probability array for the right-most box
    p[-1,t] = p[-1, t-1] + ???
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>  File &quot;/var/folders/7y/26f264rd4ldbcc1h172r7jkh0000gn/T/ipykernel_17035/3688657676.py&quot;, line 6
    p[t,b] = p[b,t-1] + ???
                        ^
SyntaxError: invalid syntax
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="problem-1-diffusion-in-a-box">
<h2>Problem 1 - Diffusion in a box<a class="headerlink" href="#problem-1-diffusion-in-a-box" title="Permalink to this headline">#</a></h2>
<p>From the Master Equation numerical integration, plot the probability distribution of the particles at time step 0, 49, and 99. How does this time-lapse show diffusion?</p>
</section>
<section id="problem-2-diffusion-in-a-smaller-box">
<h2>Problem 2 - Diffusion in a smaller box<a class="headerlink" href="#problem-2-diffusion-in-a-smaller-box" title="Permalink to this headline">#</a></h2>
<p>Repeat the numerical integration and plotting with <code class="docutils literal notranslate"><span class="pre">n_boxes</span> <span class="pre">=</span> <span class="pre">11</span></code>. Describe what you see and compare it to the plots in Problem 1.</p>
</section>
<section id="problem-3-setting-up-a-gradient">
<h2>Problem 3 - Setting up a gradient<a class="headerlink" href="#problem-3-setting-up-a-gradient" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Homeotic_protein_bicoid">Bicoid</a> is a key gene in the early development of the fruit fly, Drosophila. The protein is initially only found on the anterior (head) side of the embryo and diffuses further down the embryo over time. This ultimately results in a gradient, with diminishing amounts of Bicoid as you go further along the embryo. To simulate this process of the Bicoid gradient being set up, take the following steps:</p>
<ul class="simple">
<li><p>Edit the initial probability array (back to <code class="docutils literal notranslate"><span class="pre">n_boxes</span> <span class="pre">=</span> <span class="pre">41</span></code>) to represent this scenario with Bicoid, where initially 100% of the particle probability is in the left-most “box”.</p></li>
<li><p>Run the Master Equation integration for <code class="docutils literal notranslate"><span class="pre">n_steps</span> <span class="pre">=</span> <span class="pre">500</span></code>.</p></li>
<li><p>Plot the results at time step 0, 249, and 499.</p></li>
<li><p>Describe what you see and explain how diffusion was able to set up a gradient.</p></li>
</ul>
</section>
<section id="problem-4-fluorescence-recovery-after-photobleaching-frap">
<h2>Problem 4 - Fluorescence recovery after photobleaching (FRAP)<a class="headerlink" href="#problem-4-fluorescence-recovery-after-photobleaching-frap" title="Permalink to this headline">#</a></h2>
<p>Having developed the numerical method of integrating the master equation, let’s consider its application to the problem of fluorescence recovery after photobleaching (FRAP). In FRAP experiments, the fluorescently labeled molecules initially have a uniform distribution. Applying high intensity light, the fluorescent molecules in the desired region get photobleached, meaning that they no longer fluoresce. Over time, the fluorescent molecules that were outside the photobleached region will diffuse into it, recovering the uniform fluorescence distribution. By estimating the timescale of fluorescence recovery, experimentalists can determine the diffusion constant of fluorescently labeled molecules. To simulate FRAP, take the following steps:</p>
<ul class="simple">
<li><p>Initailize the probability array such that all 41 boxes have the same amount of fluorescence to begin with.</p></li>
<li><p>“Photobleach” the middle ten boxes, setting their probability to 0.</p></li>
<li><p>Run the Master Equation integration for <code class="docutils literal notranslate"><span class="pre">n_step</span> <span class="pre">=</span> <span class="pre">1000</span></code>.</p></li>
<li><p>Plot the results at time step 0, 449, and 999.</p></li>
<li><p>Describe what you see happening. Give a biological reason why fluorescence recovery might happen faster or slower in real life. Which parameter would you change to model this?</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="08_stochastic_simulation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Week 8: Stochastic simulations – Gillespie Algorithm</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Dr. Suzannah Beeler<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>